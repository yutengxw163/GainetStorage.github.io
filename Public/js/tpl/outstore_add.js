//eval(function(p,a,c,k,e,d){e=function(c){return(c<a?"":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1;};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p;}('i 2=0;$(".22").21();6 1S(2){i U="<1N h=\'n\' b=\'1w"+2+"\'>"+"<c h=\'n\'><j l=\'o\' f=\'1I[]\' b=\'12"+2+"\' v=\'17\' 27=\'1p(C)\'  1o=\'1u(C)\' E=\'1k\' g=\'L:#1A\'/></c>"+"<c h=\'n\'><j l=\'o\' b=\'1F"+2+"\' v=\'10\' 24/></c>"+"<c h=\'n\'><j f=\'1W[]\' l=\'o\' b=\'16"+2+"\' v=\'10\' 1o=\'13("+2+")\'/></c>"+"<c h=\'n\'><j f=\'1X[]\' l=\'o\' b=\'Z"+2+"\' v=\'10\' 1o=\'13("+2+")\'/></c>"+"<c h=\'n\'><j f=\'1V[]\' l=\'o\' b=\'19"+2+"\' v=\'10\'/></c>"+"<c h=\'n\'>"+"<x f=\'20[]\' b=\'Y"+2+"\' >"+"<N E=\'\'>--1Z--</N>"+"</x>"+"</c>"+"<c h=\'n\'><j f=\'1Y[]\' l=\'o\' b=\'1C"+2+"\' v=\'25\' /></c>"+"<c h=\'n\'><a X=\'#\' f=\'2f\' 23=\'1v("+2+")\'>2e</a></c>"+"<j f=\'29[]\' l=\'J\' b=\'1G"+2+"\' v=\'17\'/>"+"<j f=\'2d[]\' l=\'J\' E=\'"+2+"\'>"+"<j f=\'2c[]\' b=\'1U"+2+"\' l=\'J\'>"+"<j f=\'2b[]\' b=\'1T"+2+"\' l=\'J\'>"+"</1N>";B U};$("#2a").28(6(){i U=1S(2);$("#2h").u(U);15(2);1R(2);2++});6 1R(b){i 1c;$.26(\'./9.q?s=/D/2g\',6(1i){$.y(1i,6(9,H){1c=H.2k==1?"2i=2j":\'\';$(\'#Y\'+b).u("<N E=\'"+H.b+"\' "+1c+">"+H.E+"</N>")})})};6 1v(1s){$("#1w"+1s).2F()};6 1p(p){w($(p).8()==\'1k\'){$(p).M(\'g\',\'L:#1P\');$(p).8(\'\')}};6 1u(p){w($(p).8()==\'\'){$(p).M(\'g\',\'L:#1A\');$(p).8(\'1k\')}};$.I("P.1O",$.7.A,{O:6(d,r){i t=C,1d="";$.y(r,6(9,4){w(4.T!=1d){d.u("<k 2H=\'7-A-T\' g=\'o-h:1z\'>"+4.T+"</k>");1d=4.T};t.F(d,4)})},F:6(d,4){B $("<k g=\'o-h:1z\'></k>").1i("4.A",4).u($("<a></a>").o(4.2G)).2J(d)}});$.I(\'P.1D\',$.7.A,{O:6(d,r){i t=C;d.u("<k g=\'z-1l:1m;z-g:11\'><a>2I</a></k>");$.y(r,6(9,4){t.F(d,4)})}});$.I(\'P.1H\',$.7.A,{O:6(d,r){i t=C;d.u("<k g=\'z-1l:1m;z-g:11\'><a>2D</a></k>");$.y(r,6(9,4){t.F(d,4)})}});$.I(\'P.1L\',$.7.A,{O:6(d,r){i t=C;d.u("<k g=\'z-1l:1m;z-g:11\'><a>2C</a></k>");$.y(r,6(9,4){t.F(d,4)})}});6 1n(W,Q){i m=0,14=W.1x(),18=Q.1x();1y{m+=14.1B(".")[1].1q}1r(e){} 1y{m+=18.1B(".")[1].1q}1r(e){} B 1t(14.1Q(".",""))*1t(18.1Q(".",""))/2E.2O(10,m)};6 13(2){i W=$("#16"+2).8();i Q=$("#Z"+2).8();$("#19"+2).8(1n(W,Q))};6 15(2){$("#12"+2).1O({K:\'./9.q?s=/D/2L\',V:1,S:0,x:6(R,7){$("#12"+2).M(\'g\',\'L:#1P\');$("#16"+2).8(7.4.1E);$("#1T"+2).8(7.4.2K);$("#1U"+2).8(7.4.2N);$("#1F"+2).8(7.4.2M);$("#1G"+2).8(7.4.2q);$("#Y"+2).8(7.4.2p);$("#Z"+2).8(1);$("#19"+2).8(1n(7.4.1E,1));$("#1C"+2).8(7.4.2s)}})};$(6(){$("#2r").1D({K:\'./9.q?s=/D/1M\',V:1,S:0,x:6(R,7){w(1f(7.4)==\'1g\'){1h.1j.X=\'./9.q?s=/1b/9/1a/5\';B 1e};$("#2m").8(7.4.b)}});$("#2l").1H({K:\'./9.q?s=/D/2o\',V:1,S:0,x:6(R,7){w(1f(7.4)==\'1g\'){1h.1j.X=\'./9.q?s=/1b/9/1a/3\';B 1e};$("#2n").8(7.4.b)}});$("#2t").1L({K:\'./9.q?s=/D/1M\',V:1,S:0,x:6(R,7){w(1f(7.4)==\'1g\'){1h.1j.X=\'./9.q?s=/1b/9/1a/5\';B 1e};$("#2z").8(7.4.b)}});2y(1J){1K\'2B\':G=G+\'/2A\';2v;1K\'2u\':G=G+\'/2x\';$("j[f=\'1I[]\']").y(6(9,H){15(9)})};$(\'#2w\').M(\'1J\',G)});',62,175,'||id_num||item||function|ui|val|index||id|td|ul||name|style|align|var|input|li|type||center|text|obj|php|items||self|append|size|if|select|each|font|autocomplete|return|this|Outstore|value|_renderItem|url|ele|widget|hidden|source|color|attr|option|_renderMenu|custom|arg2|event|delay|category|row|minLength|arg1|href|oss_store_|oss_count_||italic|oss_prodname_|compute|s1|bindAutoComplete|oss_price_||s2|oss_total_|selectNum|BaseData|isdefault|currentCategory|false|typeof|undefined|window|data|location|请输入关键字或空格|weight|bold|mul|onblur|clearTip|length|catch|rowid|Number|fillTip|deleteRow|row_|toString|try|left|CCC|split|oss_remark_|autocomplete_operator|stk_price|oss_cate_name_|oss_stockid_|autocomplete_customer|oss_prodname|action|case|autocomplete_writer|getOperator|tr|catcomplete|000|replace|bindStore|getRow|oss_prod_|oss_cate_|oss_total|oss_price|oss_count|oss_remark|请选择|oss_store|button|btn|onclick|disabled||getJSON|onfocus|click|oss_stockid|btnAdd|oss_prod|oss_cate|row_count|删除|linkDelete|getStore|table|selected|true|sto_isdefault|osm_customer_name|osm_operator|osm_customer|getCustomer|stk_store|stk_id|osm_operator_name|stk_remark|osm_writer_name|update|break|form1|doEdit|switch|osm_writer|doAdd|add|添加制单人|添加客户|Math|remove|label|class|添加经办人|appendTo|stk_prod|getStock|pdca_name|stk_cate|pow'.split('|'),0,{}))
var id_num = 0;
$(".btn").button();

function getRow(id_num) {
	var row = "<tr align='center' id='row_" + id_num + "'>" + "<td align='center'><input type='text' name='oss_prodname[]' id='oss_prodname_" + id_num + "' size='17' onfocus='clearTip(this)'  onblur='fillTip(this)' value='请输入关键字或空格' style='color:#CCC'/></td>" + "<td align='center'><input type='text' id='oss_cate_name_" + id_num + "' size='10' disabled/></td>" + "<td align='center'><input name='oss_price[]' type='text' id='oss_price_" + id_num + "' size='10' onblur='compute(" + id_num + ")'/></td>" + "<td align='center'><input name='oss_count[]' type='text' id='oss_count_" + id_num + "' size='10' onblur='compute(" + id_num + ")'/></td>" + "<td align='center'><input name='oss_total[]' type='text' id='oss_total_" + id_num + "' size='10'/></td>" + "<td align='center'>" + "<select name='oss_store[]' id='oss_store_" + id_num + "' >" + "<option value=''>--请选择--</option>" + "</select>" + "</td>" + "<td align='center'><input name='oss_remark[]' type='text' id='oss_remark_" + id_num + "' size='25' /></td>" + "<td align='center'><a href='#' name='linkDelete' onclick='deleteRow(" + id_num + ")'>删除</a></td>" + "<input name='oss_stockid[]' type='hidden' id='oss_stockid_" + id_num + "' size='17'/>" + "<input name='row_count[]' type='hidden' value='" + id_num + "'>" + "<input name='oss_cate[]' id='oss_cate_" + id_num + "' type='hidden'>" + "<input name='oss_prod[]' id='oss_prod_" + id_num + "' type='hidden'>" + "</tr>";
	return row
};
$("#btnAdd").click(function() {
	var row = getRow(id_num);
	$("#table").append(row);
	bindAutoComplete(id_num);
	bindStore(id_num);
	id_num++
});

function bindStore(id) {
	var isdefault;
	$.getJSON('./index.php?s=/Storage/Outstore/getStore', function(data) {
		$.each(data, function(index, ele) {
			isdefault = ele.sto_isdefault == 1 ? "selected=true" : '';
			$('#oss_store_' + id).append("<option value='" + ele.id + "' " + isdefault + ">" + ele.value + "</option>")
		})
	})
};

function deleteRow(rowid) {
	$("#row_" + rowid).remove()
};

function clearTip(obj) {
	if ($(obj).val() == '请输入关键字或空格') {
		$(obj).attr('style', 'color:#000');
		$(obj).val('')
	}
};

function fillTip(obj) {
	if ($(obj).val() == '') {
		$(obj).attr('style', 'color:#CCC');
		$(obj).val('请输入关键字或空格')
	}
};
$.widget("custom.catcomplete", $.ui.autocomplete, {
	_renderMenu: function(ul, items) {
		var self = this,
			currentCategory = "";
		$.each(items, function(index, item) {
			if (item.category != currentCategory) {
				ul.append("<li class='ui-autocomplete-category' style='text-align:left'>" + item.category + "</li>");
				currentCategory = item.category
			};
			self._renderItemData(ul, item)
		})
	},
	_renderItem: function(ul, item) {
		return $("<li style='text-align:left'></li>").data("item.autocomplete", item).append($("<a></a>").text(item.label)).appendTo(ul)
	}
});
$.widget('custom.autocomplete_operator', $.ui.autocomplete, {
	_renderMenu: function(ul, items) {
		var self = this;
		ul.append("<li style='font-weight:bold;font-style:italic'><a>添加经办人</a></li>");
		$.each(items, function(index, item) {
			self._renderItemData(ul, item)
		})
	}
});
$.widget('custom.autocomplete_customer', $.ui.autocomplete, {
	_renderMenu: function(ul, items) {
		var self = this;
		ul.append("<li style='font-weight:bold;font-style:italic'><a>添加客户</a></li>");
		$.each(items, function(index, item) {
			self._renderItemData(ul, item)
		})
	}
});
$.widget('custom.autocomplete_writer', $.ui.autocomplete, {
	_renderMenu: function(ul, items) {
		var self = this;
		ul.append("<li style='font-weight:bold;font-style:italic'><a>添加制单人</a></li>");
		$.each(items, function(index, item) {
			self._renderItemData(ul, item)
		})
	}
});

function mul(arg1, arg2) {
	var m = 0,
		s1 = arg1.toString(),
		s2 = arg2.toString();
	try {
		m += s1.split(".")[1].length
	} catch (e) {}
	try {
		m += s2.split(".")[1].length
	} catch (e) {}
	return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m)
};

function compute(id_num) {
	var arg1 = $("#oss_price_" + id_num).val();
	var arg2 = $("#oss_count_" + id_num).val();
	$("#oss_total_" + id_num).val(mul(arg1, arg2))
};

function bindAutoComplete(id_num) {
	$("#oss_prodname_" + id_num).catcomplete({
		source: './index.php?s=/Storage/Outstore/getStock',
		minLength: 1,
		delay: 0,
		select: function(event, ui) {
			$("#oss_prodname_" + id_num).attr('style', 'color:#000');
			$("#oss_price_" + id_num).val(ui.item.stk_price);
			$("#oss_prod_" + id_num).val(ui.item.stk_prod);
			$("#oss_cate_" + id_num).val(ui.item.stk_cate);
			$("#oss_cate_name_" + id_num).val(ui.item.pdca_name);
			$("#oss_stockid_" + id_num).val(ui.item.stk_id);
			$("#oss_store_" + id_num).val(ui.item.stk_store);
			$("#oss_count_" + id_num).val(1);
			$("#oss_total_" + id_num).val(mul(ui.item.stk_price, 1));
			$("#oss_remark_" + id_num).val(ui.item.stk_remark)
		}
	})
};
$(function() {
	$("#osm_operator_name").autocomplete_operator({
		source: './index.php?s=/Storage/Outstore/getOperator',
		minLength: 1,
		delay: 0,
		select: function(event, ui) {
			if (typeof(ui.item) == 'undefined') {
				window.location.href = './index.php?s=/Storage/BaseData/index/selectNum/5';
				return false
			};
			$("#osm_operator").val(ui.item.id)
		}
	});
	$("#osm_customer_name").autocomplete_customer({
		source: './index.php?s=/Storage/Outstore/getCustomer',
		minLength: 1,
		delay: 0,
		select: function(event, ui) {
			if (typeof(ui.item) == 'undefined') {
				window.location.href = './index.php?s=/Storage/BaseData/index/selectNum/3';
				return false
			};
			$("#osm_customer").val(ui.item.id)
		}
	});
	$("#osm_writer_name").autocomplete_writer({
		source: './index.php?s=/Storage/Outstore/getOperator',
		minLength: 1,
		delay: 0,
		select: function(event, ui) {
			if (typeof(ui.item) == 'undefined') {
				window.location.href = './index.php?s=/Storage/BaseData/index/selectNum/5';
				return false
			};
			$("#osm_writer").val(ui.item.id)
		}
	});
	switch (action) {
	case 'add':
		url = url + '/doAdd';
		break;
	case 'update':
		url = url + '/doEdit';
		$("input[name='oss_prodname[]']").each(function(index, ele) {
			bindAutoComplete(index)
		})
	};
	$('#form1').attr('action', url)
});